{% extends "products/base.html" %}
{% load static %}
{% load my_filters %}
{% block css %}
    <link href="{% static 'css/product_detail.css' %}" rel="stylesheet">
{% endblock css %}

{% block content %}

<!-- content -->
<section class="py-5">
  <div class="container">
    <div class="row gx-5">
      <aside class="col-lg-6">
        <div class="border rounded-4 mb-3 d-flex justify-content-center">
            <img style="max-width: 70%; max-height: 70vh; margin: auto;" class="rounded-4 fit" src="{{ product.image.url }}" />
        </div>
      </aside>
      <main class="col-lg-6">
        {% if messages %}
          <div class="alert alert-success alert-dismissible fade show" role="alert">
            {% for message in messages %}
              {{ message }}
            {% endfor %}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
        {% endif %}
        <div class="ps-lg-3">
          <h4 class="title text-dark">
            {{ product.title }}
          </h4>
          <div class="d-flex flex-row my-3">
            <div class="text-warning mb-1 me-2">
              {% for _ in product.average_rating|range %}
                <i class="fa fa-star"></i>
              {% endfor %}
              {% for _ in product.average_rating|range:5 %}
              <i class="far fa-star"></i>
              {% endfor %}

            </div>
          </div>

          <div class="mb-3">
            <span class="h5">{{ product.price }} руб.</span>
            <span class="text-muted">/шт.</span>
            {% if product.amount > 0 %}
              <span class="text-success ms-2">В наличии</span>
            {% elif product.amount == 0 %}
              <span class="text-danger ms-2">Товар закончился</span>
            {% endif %}
          </div>

          <p>
            {{ product.description }}
          </p>

          <div class="row">
            <dt class="col-3">Категория:</dt>
            <dd class="col-9">{{ product.category }}</dd>
          </div>

          <hr />

          
          {% if product.amount > 0 %}
            <a href="{% url "products:cart_add" product.id %}" class="btn btn-success shadow-0"> <i class="me-1 fa fa-shopping-basket"></i> В корзину </a>
            <a href="#" class="btn btn-primary border border-secondary py-2 icon-hover px-3"><i class="me-1 fa fa-heart fa-lg"></i></a>
          {% elif product.amount == 0 %}
            <a href="#" class="btn btn-primary border border-secondary py-2 icon-hover px-3"> Добавить в избранное <i class="me-1 fa fa-heart fa-lg"></i></a>
          {% endif %}
          
          {% if not is_rated %}
           <div class="rate bg-dark py-3 text-white mt-3">
            <form method="post" action="{% url 'products:rate' pk=product.id %}">
                {% csrf_token %}
                <input type='hidden' name="user" value="{{ user.id }}"/>
                <input type='hidden' name="product" value="{{ product.id }}"/>
                <div class="rating"> 
                    <input type="radio" name="rating" value="5" id="5">
                    <label for="5">☆</label> 
                    <input type="radio" name="rating" value="4" id="4">
                    <label for="4">☆</label> 
                    <input type="radio" name="rating" value="3" id="3">
                    <label for="3">☆</label> 
                    <input type="radio" name="rating" value="2" id="2">
                    <label for="2">☆</label> 
                    <input type="radio" name="rating" value="1" id="1">
                    <label for="1">☆</label>
                </div>

                <div class="buttons px-4 mt-0">
                    <button class="btn btn-success btn-block rating-submit">Оценить</button>
                </div>
            </form>
            {% endif %}
            </div>
        </div>
      </main>
    </div>
  </div>
</section>
<!-- content -->


{% endblock  %}
